<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Blocking Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { 
            padding-top: 20px; 
            background: #f8f9fa;
        }
        .city-tabs { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-tabs .nav-link { 
            color: #495057; 
        }
        .nav-tabs .nav-link.active { 
            font-weight: 600; 
        }
        .table-container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-blocked { 
            background: #ffc107; 
            color: #000; 
        }
        .status-confirmed { 
            background: #28a745; 
            color: #fff; 
        }
        .status-cancellation { 
            background: #ff9800; 
            color: #fff; 
        }
        .status-cancelled { 
            background: #dc3545; 
            color: #fff; 
        }
        .deadline-warning { 
            background-color: #fff3cd !important;
        }
        .stats-card {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .btn-action {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        table {
            font-size: 0.9rem;
        }
        .modal-lg {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Hotel Blocking Tracker</h2>
            <div>
                <button class="btn btn-success" onclick="exportData()">
                    <i class="bi bi-download"></i> Export Data
                </button>
                <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">
                    <i class="bi bi-upload"></i> Import Data
                </button>
                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
            </div>
        </div>

        <div class="city-tabs">
            <ul class="nav nav-tabs" id="cityTabs" role="tablist"></ul>
        </div>

        <div class="tab-content" id="cityTabContent"></div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add Booking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <input type="hidden" id="bookingId">
                        <input type="hidden" id="bookingCity">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Hotel Name *</label>
                                <input type="text" class="form-control" id="hotelName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Rooms Config *</label>
                                <input type="text" class="form-control" id="roomsConfig" placeholder="e.g., 18 dbl+4 sgl" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Check-in *</label>
                                <input type="date" class="form-control" id="checkIn" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Check-out *</label>
                                <input type="date" class="form-control" id="checkOut" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Price/Person/Night *</label>
                                <input type="number" class="form-control" id="pricePerPerson" step="0.01" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Status *</label>
                                <select class="form-select" id="status" required>
                                    <option value="blocked">Blocked</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="cancellation">Cancellation</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Cancellation Deadline</label>
                                <input type="date" class="form-control" id="cancellationDeadline">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Payment Deadline</label>
                                <input type="date" class="form-control" id="paymentDeadline">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveBooking()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // European cities data
        const cities = {
            'France': ['Paris', 'Nice', 'Lyon', 'Marseille'],
            'Italy': ['Rome', 'Venice', 'Florence', 'Milan'],
            'Spain': ['Barcelona', 'Madrid', 'Seville', 'Valencia'],
            'Germany': ['Berlin', 'Munich', 'Frankfurt', 'Hamburg'],
            'Netherlands': ['Amsterdam', 'Rotterdam', 'The Hague', 'Utrecht'],
            'Belgium': ['Brussels', 'Bruges', 'Antwerp', 'Ghent'],
            'Austria': ['Vienna', 'Salzburg', 'Innsbruck', 'Graz'],
            'Switzerland': ['Zurich', 'Geneva', 'Lucerne', 'Interlaken'],
            'Czech Republic': ['Prague', 'Cesky Krumlov', 'Brno', 'Karlovy Vary'],
            'Portugal': ['Lisbon', 'Porto', 'Faro', 'Sintra'],
            'Greece': ['Athens', 'Santorini', 'Mykonos', 'Crete'],
            'Poland': ['Warsaw', 'Krakow', 'Gdansk', 'Wroclaw'],
            'Hungary': ['Budapest', 'Eger', 'Pecs', 'Debrecen'],
            'Denmark': ['Copenhagen', 'Aarhus', 'Odense', 'Aalborg'],
            'Sweden': ['Stockholm', 'Gothenburg', 'Malmo', 'Uppsala'],
            'Norway': ['Oslo', 'Bergen', 'Trondheim', 'Stavanger'],
            'Finland': ['Helsinki', 'Tampere', 'Turku', 'Rovaniemi'],
            'Iceland': ['Reykjavik', 'Akureyri', 'Vik', 'Hofn'],
            'UK': ['London', 'Edinburgh', 'Manchester', 'Liverpool']
        };

        let bookings = {};
        let currentCity = '';
        let editingId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeCities();
            if (Object.keys(bookings).length === 0) {
                // First time - initialize empty structure
                Object.values(cities).flat().forEach(city => {
                    bookings[city] = [];
                });
                saveData();
            }
            showCity(Object.values(cities).flat()[0]);
        });

        function initializeCities() {
            const tabsContainer = document.getElementById('cityTabs');
            const contentContainer = document.getElementById('cityTabContent');
            
            Object.entries(cities).forEach(([country, cityList], countryIndex) => {
                // Add country header
                const countryHeader = document.createElement('li');
                countryHeader.className = 'nav-item dropdown';
                countryHeader.innerHTML = `
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">
                        ${country}
                    </a>
                    <ul class="dropdown-menu" id="dropdown-${country.replace(/\s/g, '')}"></ul>
                `;
                tabsContainer.appendChild(countryHeader);

                const dropdown = document.getElementById(`dropdown-${country.replace(/\s/g, '')}`);
                
                cityList.forEach((city, cityIndex) => {
                    // Add to dropdown
                    const dropdownItem = document.createElement('li');
                    dropdownItem.innerHTML = `<a class="dropdown-item" href="#" onclick="showCity('${city}'); return false;">${city}</a>`;
                    dropdown.appendChild(dropdownItem);

                    // Initialize booking array if not exists
                    if (!bookings[city]) bookings[city] = [];

                    // Create tab content
                    const tabPane = document.createElement('div');
                    tabPane.className = 'tab-pane fade';
                    tabPane.id = `city-${city.replace(/\s/g, '')}`;
                    tabPane.innerHTML = `
                        <div class="stats-card">
                            <div class="row">
                                <div class="col-md-3">
                                    <strong>Total Bookings:</strong> <span id="total-${city}">0</span>
                                </div>
                                <div class="col-md-3">
                                    <strong>Total Rooms:</strong> <span id="rooms-${city}">0</span>
                                </div>
                                <div class="col-md-3">
                                    <strong>Blocked:</strong> <span id="blocked-${city}">0</span>
                                </div>
                                <div class="col-md-3">
                                    <strong>Confirmed:</strong> <span id="confirmed-${city}">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4>${city}</h4>
                            <button class="btn btn-primary" onclick="addBooking('${city}')">
                                <i class="bi bi-plus-circle"></i> Add Booking
                            </button>
                        </div>
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Hotel</th>
                                            <th>Check-in</th>
                                            <th>Check-out</th>
                                            <th>Rooms</th>
                                            <th>Price/Person</th>
                                            <th>Status</th>
                                            <th>Canx Deadline</th>
                                            <th>Payment Deadline</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-${city}"></tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    contentContainer.appendChild(tabPane);
                });
            });
        }

        function showCity(city) {
            currentCity = city;
            
            // Hide all tabs
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('show', 'active');
            });
            
            // Show selected tab
            const pane = document.getElementById(`city-${city.replace(/\s/g, '')}`);
            if (pane) {
                pane.classList.add('show', 'active');
                renderCity(city);
            }
        }

        function renderCity(city) {
            const tbody = document.getElementById(`tbody-${city}`);
            const cityBookings = bookings[city] || [];
            
            if (cityBookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center text-muted">No bookings yet</td></tr>';
                updateStats(city);
                return;
            }

            const today = new Date();
            const sevenDaysFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

            tbody.innerHTML = cityBookings.map(booking => {
                const canxDeadline = booking.cancellationDeadline ? new Date(booking.cancellationDeadline) : null;
                const isWarning = canxDeadline && canxDeadline >= today && canxDeadline <= sevenDaysFromNow;
                
                return `
                    <tr class="${isWarning ? 'deadline-warning' : ''}">
                        <td>${booking.hotelName}</td>
                        <td>${formatDate(booking.checkIn)}</td>
                        <td>${formatDate(booking.checkOut)}</td>
                        <td>${booking.roomsConfig}</td>
                        <td>â‚¬${booking.pricePerPerson}</td>
                        <td><span class="badge status-${booking.status}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                        <td>${booking.cancellationDeadline ? formatDate(booking.cancellationDeadline) : '-'}</td>
                        <td>${booking.paymentDeadline ? formatDate(booking.paymentDeadline) : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary btn-action" onclick="editBooking('${city}', '${booking.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteBooking('${city}', '${booking.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            updateStats(city);
        }

        function updateStats(city) {
            const cityBookings = bookings[city] || [];
            
            document.getElementById(`total-${city}`).textContent = cityBookings.length;
            
            // Calculate total rooms (parse from config like "18 dbl+4 sgl")
            const totalRooms = cityBookings.reduce((sum, b) => {
                const matches = b.roomsConfig.match(/\d+/g);
                return sum + (matches ? matches.reduce((a, c) => a + parseInt(c), 0) : 0);
            }, 0);
            document.getElementById(`rooms-${city}`).textContent = totalRooms;
            
            const blocked = cityBookings.filter(b => b.status === 'blocked').length;
            const confirmed = cityBookings.filter(b => b.status === 'confirmed').length;
            
            document.getElementById(`blocked-${city}`).textContent = blocked;
            document.getElementById(`confirmed-${city}`).textContent = confirmed;
        }

        function addBooking(city) {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add Booking';
            document.getElementById('bookingCity').value = city;
            document.getElementById('bookingForm').reset();
            new bootstrap.Modal(document.getElementById('bookingModal')).show();
        }

        function editBooking(city, id) {
            const booking = bookings[city].find(b => b.id === id);
            if (!booking) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Booking';
            document.getElementById('bookingCity').value = city;
            document.getElementById('bookingId').value = id;
            document.getElementById('hotelName').value = booking.hotelName;
            document.getElementById('roomsConfig').value = booking.roomsConfig;
            document.getElementById('checkIn').value = booking.checkIn;
            document.getElementById('checkOut').value = booking.checkOut;
            document.getElementById('pricePerPerson').value = booking.pricePerPerson;
            document.getElementById('status').value = booking.status;
            document.getElementById('cancellationDeadline').value = booking.cancellationDeadline || '';
            document.getElementById('paymentDeadline').value = booking.paymentDeadline || '';
            document.getElementById('notes').value = booking.notes || '';

            new bootstrap.Modal(document.getElementById('bookingModal')).show();
        }

        function saveBooking() {
            const city = document.getElementById('bookingCity').value;
            const booking = {
                id: editingId || Date.now().toString(),
                hotelName: document.getElementById('hotelName').value,
                roomsConfig: document.getElementById('roomsConfig').value,
                checkIn: document.getElementById('checkIn').value,
                checkOut: document.getElementById('checkOut').value,
                pricePerPerson: document.getElementById('pricePerPerson').value,
                status: document.getElementById('status').value,
                cancellationDeadline: document.getElementById('cancellationDeadline').value,
                paymentDeadline: document.getElementById('paymentDeadline').value,
                notes: document.getElementById('notes').value
            };

            if (editingId) {
                const index = bookings[city].findIndex(b => b.id === editingId);
                bookings[city][index] = booking;
            } else {
                if (!bookings[city]) bookings[city] = [];
                bookings[city].push(booking);
            }

            saveData();
            renderCity(city);
            bootstrap.Modal.getInstance(document.getElementById('bookingModal')).hide();
        }

        function deleteBooking(city, id) {
            if (!confirm('Delete this booking?')) return;
            bookings[city] = bookings[city].filter(b => b.id !== id);
            saveData();
            renderCity(city);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-GB');
        }

        function saveData() {
            localStorage.setItem('hotelBookings', JSON.stringify(bookings));
        }

        function loadData() {
            const saved = localStorage.getItem('hotelBookings');
            if (saved) {
                bookings = JSON.parse(saved);
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(bookings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `hotel-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('This will replace all current data. Continue?')) {
                        bookings = imported;
                        saveData();
                        showCity(currentCity);
                        alert('Data imported successfully');
                    }
                } catch (err) {
                    alert('Invalid file format');
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
